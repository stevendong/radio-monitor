# 通知配置指南

当发现符合条件的新考试时，自动推送通知到微信。

---

## 📱 支持的通知方式

### 方式一：Server酱（推荐）

**优点：** 配置简单，推送到微信服务号，免费额度充足

**步骤：**

1. **注册Server酱**
   - 访问：https://sct.ftqq.com/
   - 微信扫码登录
   - 完成微信公众号绑定

2. **获取SendKey**
   - 进入「SendKey」页面
   - 复制你的SendKey（格式：`SCT123456...`）

3. **配置到GitHub**
   - 访问：`https://github.com/你的用户名/radio-monitor/settings/secrets/actions`
   - 点击 `New repository secret`
   - Name: `NOTIFICATION_TOKEN`
   - Value: 粘贴你的SendKey
   - 点击 `Add secret`

4. **设置通知类型（可选）**
   - 访问：`https://github.com/你的用户名/radio-monitor/settings/variables/actions`
   - 点击 `New repository variable`
   - Name: `NOTIFICATION_TYPE`
   - Value: `serverchan`
   - 点击 `Add variable`

**完成！** 下次运行时发现新考试会自动推送。

---

### 方式二：PushPlus

**优点：** 微信一对一推送，功能更丰富

**步骤：**

1. **注册PushPlus**
   - 访问：https://www.pushplus.plus/
   - 微信扫码登录

2. **获取Token**
   - 进入「发送消息」页面
   - 复制你的Token

3. **配置到GitHub**
   - 访问：`https://github.com/你的用户名/radio-monitor/settings/secrets/actions`
   - 点击 `New repository secret`
   - Name: `NOTIFICATION_TOKEN`
   - Value: 粘贴你的Token
   - 点击 `Add secret`

4. **设置通知类型**
   - 访问：`https://github.com/你的用户名/radio-monitor/settings/variables/actions`
   - 点击 `New repository variable`
   - Name: `NOTIFICATION_TYPE`
   - Value: `pushplus`
   - 点击 `Add variable`

**完成！**

---

## 🔔 通知内容示例

推送消息格式：

```
📻 无线电考试监控

发现 1 个符合条件的考试：

---

### 1. （11月8日广州）广东省A、B类业余电台操作技能考试报名通知

- 📅 考试日期: 2025-11-08
- 📍 考试地点: 广州、东莞
- 📝 考试类型: A类、B类
- 🏢 考试场地: 广州市花都区森林消防大队
- 📆 报名时间: 2025年10月20日至2025年10月30日
- 🔗 查看详情: [点击查看](http://www.ragd.org.cn/newsinfo/8789915.html)

---

🤖 此消息由自动监控系统发送
```

---

## 🎯 通知策略

### 去重机制

- 每个考试有唯一ID（从URL提取）
- 系统会记录所有已推送过的考试ID
- **只在首次发现新考试时推送一次**
- 已推送过的考试不会重复通知

### 推送时机

- ✅ 首次发现符合筛选条件的考试 → 推送
- ❌ 已推送过的考试再次检测到 → 不推送
- ✅ 筛选条件变化后新匹配的考试 → 推送

---

## ⚙️ 高级配置

### 本地测试

```bash
# Server酱
export NOTIFICATION_TOKEN="SCT123456..."
export NOTIFICATION_TYPE="serverchan"
npm start

# PushPlus
export NOTIFICATION_TOKEN="你的PushPlus Token"
export NOTIFICATION_TYPE="pushplus"
npm start
```

### 关闭通知

如果只想监控数据不推送通知：

- 删除GitHub Secrets中的 `NOTIFICATION_TOKEN`
- 或者将Token留空

系统会自动检测，没有Token时不推送。

### 查看推送记录

项目会生成 `notified_exams.json` 文件：

```json
{
  "lastUpdated": "2025-10-22T10:00:00.000Z",
  "notifiedIds": ["8789915", "8789916"],
  "count": 2
}
```

这个文件会自动提交到GitHub仓库。

---

## 🐛 故障排查

### Q: 为什么没有收到推送？

**检查清单：**

1. **Token配置正确？**
   - Settings → Secrets → 检查 `NOTIFICATION_TOKEN` 存在
   - 确认Token没有多余空格

2. **有新考试吗？**
   - Actions → 查看最新运行日志
   - 看到 `🆕 新增考试: 0 条` 说明没有新考试

3. **通知类型匹配？**
   - Server酱Token配置了 `serverchan` 类型
   - PushPlus Token配置了 `pushplus` 类型

4. **Token有效？**
   - 访问Server酱或PushPlus官网测试发送

### Q: 收到重复通知怎么办？

**可能原因：**
- `notified_exams.json` 文件被删除或未提交

**解决方法：**
- 检查GitHub仓库是否有 `notified_exams.json` 文件
- 确认GitHub Actions有写权限（Settings → Actions → Workflow permissions → Read and write）

### Q: 想清空推送历史重新通知？

```bash
# 删除历史文件
rm notified_exams.json

# 提交更改
git add notified_exams.json
git commit -m "清空推送历史"
git push
```

下次运行时会把所有匹配的考试当作新考试推送。

---

## 💡 使用建议

1. **首次配置后手动运行测试**
   - Actions → 考试监控 → Run workflow
   - 查看日志确认推送成功

2. **保持微信在线**
   - Server酱推送到服务号，需要关注公众号
   - PushPlus推送到微信，需要绑定微信

3. **定期检查**
   - 即使没收到推送，也定期查看 `exams.json` 文件
   - 避免错过重要考试

---

## 📞 获取帮助

- Server酱文档：https://sct.ftqq.com/
- PushPlus文档：https://www.pushplus.plus/doc/

---

**配置完成后，每小时自动检查，发现新考试立即推送！** 🎉
